<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.0 on Fri Jan 16 23:50:52 2009 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ajs_double_choloniewski_fit.pro (Anthony Smith's IDL routines)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ajs_double_choloniewski_fit.pro (Anthony Smith's IDL routines)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'idl'</span>
<span class="comments">;+</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;       (NB: unlikely to be useful!) This function finds the</span>
<span class="comments">;       best-fitting double Choloniewski function for input arrays of</span>
<span class="comments">;       absolute magnitudes, surface brightness, phi and phi_err.</span>
<span class="comments">;-</span>

<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	ajs_double_choloniewski_fit</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	This function finds the best-fitting double Choloniewski function for</span>
<span class="comments">;	input arrays of absolute magnitudes, surface brightness, phi</span>
<span class="comments">;	and phi_err.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;	absmag</span>
<span class="comments">;	sbr</span>
<span class="comments">;	phi</span>
<span class="comments">;	phierr</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;	params_init	Initial guess for </span>
<span class="comments">;			[mstar,alpha,phistar,sbstar,sigmasb,beta]</span>
<span class="comments">;			twice (or default)</span>
<span class="comments">;</span>
<span class="comments">; KEYWORD PARAMETERS:</span>
<span class="comments">;	txtfile		Output text file</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;	Result	[mstar,alpha,phistar,sbstar,sigmasb,beta]</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUTS:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;	Uses mpfit2d (idlutils)</span>
<span class="comments">;	ajs_choloniewski</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;	17 Jan 2008 Created, Anthony Smith</span>
<span class="comments">;-</span>
FUNCTION ajs_double_choloniewski_fit, absmag, sb, phi, phierr, params_init, $
                                      txtfile=txtfile
  compile_opt idl2

  IF n_elements(params_init) EQ 0 THEN $
     params_init=[median(absmag) - 1, -0.5, 0.01, $
                  median(sb) - 1, 0.5, 0.2, $
                  median(absmag) + 1, -1.5, 0.01, $
                  median(sb) + 1, 1.5, 0.6]
  params_init = double(params_init)

  absmag_arr = absmag # (sb * 0 + 1)
  sb_arr = (absmag * 0 + 1) # sb

  parinfo = replicate({value:0.D, fixed:0, limited:[0,0], $
                       limits:[0.D,0]}, 12)
  parinfo[1].limited = [1, 1]
  parinfo[1].limits  = double([1e-3, 1e-1])
  parinfo[7].limited = [1, 1]
  parinfo[7].limits  = [1e-3, 1e-1]

  params=mpfit2dfun('ajs_double_choloniewski', $
                    absmag_arr, $
                    sb_arr, $
                    phi, $
                    phierr, $
                    params_init, /quiet, covar=covar, perror=perror, $
                    parinfo=parinfo)
<span class="comments">;;   print, 'PError:', float(perror)</span>
<span class="comments">;;   print, 'Covariance:'</span>
<span class="comments">;;   print, float(covar)</span>
<span class="comments">;;   PCOR = covar * 0</span>
<span class="comments">;;   n = 6</span>
<span class="comments">;;   FOR i = 0, n-1 DO FOR j = 0, n-1 DO $</span>
<span class="comments">;;      PCOR(i,j) = covar(i,j)/sqrt(covar(i,i)*covar(j,j))</span>
<span class="comments">;;   print, 'Correlation:'</span>
<span class="comments">;;   print, float(pcor)</span>

  IF keyword_set(txtfile) THEN BEGIN
      <span class="comments">;; Text file</span>
      openw, unit, txtfile, /get_lun
      printf, unit, params
      free_lun, unit
  ENDIF

  RETURN,params

END

PRO ajs_choloniewski_fit_test

  <span class="comments">;; This works:</span>
<span class="comments">;;   params_true = [-24, 0, 1e-2, 17, 0.5, 0, $</span>
<span class="comments">;;                  -21, -1, 1e-2, 18, 0.9, 0.5]                 </span>
  params_true = [-24, 0, 1e-2, 17, 0.5, 0, $
                 -22, -1, 1e-2, 18, 0.9, 0.5]                 
  m = ajs_linspace(-16, -26, 21)
  sb = ajs_linspace(22, 14, 21)
  print,'Starting with'
  print, params_true[0:5]
  print, params_true[6:11]
  chol = ajs_double_choloniewski(m, sb, params_true)
  cholerr = chol / 10
  ajs_bbd_plot, m, sb, chol, /show_plot, plotfile='/tmp/bbd.eps'

  <span class="comments">;; Fit</span>
<span class="comments">;  params_init = params_true * 1.1</span>
  params = ajs_double_choloniewski_fit(m, sb, chol, cholerr)<span class="comments">;, params_init)</span>
  print,'Fitted parameters:'
  print, params[0:5]
  print, params[6:11]
  cholfit = ajs_double_choloniewski(m, sb, params)
  ajs_bbd_plot, m, sb, cholfit, /show_plot, plotfile='/tmp/bbd2.eps'


END
</code>
    </div>
  </body>
</html>