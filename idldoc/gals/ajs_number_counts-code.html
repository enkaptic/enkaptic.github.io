<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.0 on Fri Jan 16 23:50:55 2009 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ajs_number_counts.pro (Anthony Smith's IDL routines)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ajs_number_counts.pro (Anthony Smith's IDL routines)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;+</span>
<span class="comments">; This procedure calculates the number counts from an input array of</span>
<span class="comments">; magnitudes or log(flux)</span>
<span class="comments">;-</span>


<span class="comments">;+</span>
<span class="comments">; This procedure calculates the number counts from an input array of</span>
<span class="comments">; magnitudes or log(flux)</span>
<span class="comments">;</span>
<span class="comments">; Bins must have equal width</span>
<span class="comments">;</span>
<span class="comments">; :Returns: fltarr/dblarr</span>
<span class="comments">;    Returns the number of galaxies per mag or log(flux), per square degree</span>
<span class="comments">; :Params:</span>
<span class="comments">;    mag : in, required</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;    area : in, optional</span>
<span class="comments">;       Area in square degrees</span>
<span class="comments">;    bincentres : in, out, optional</span>
<span class="comments">;       Centre of each bin in magnitude</span>
<span class="comments">;    err_ngals : out, optional</span>
<span class="comments">;       Poisson errors = n / sqrt(n)</span>
<span class="comments">;    ninbin : out, optional</span>
<span class="comments">;       Number of galaxies in each bin</span>
<span class="comments">;    nbins : in, optional</span>
<span class="comments">;       Number of bins (ignored if bincentres set)</span>
<span class="comments">;    xrange : in, optional</span>
<span class="comments">;       Minimum and maximum mag (ignored if bincentres set)</span>
<span class="comments">; :History:</span>
<span class="comments">;    5 Sep 2007 Created (Anthony Smith)</span>
<span class="comments">;</span>
<span class="comments">;    6 Mar 2008 Re-written</span>
<span class="comments">;</span>
<span class="comments">;    18 Mar 2008 Added jackknife</span>
<span class="comments">;</span>
<span class="comments">;    7 Apr 2008 Jackknife estimation of Schechter function fit</span>
<span class="comments">;</span>
<span class="comments">;    15 Apr 2008 Added luminosity density</span>
<span class="comments">;</span>
<span class="comments">;    21 Apr 2008 Added double Schechter function</span>
<span class="comments">;-</span>
FUNCTION ajs_number_counts, $
   mag, $
   area=area, $
   bincentres=bincentres, $
   err_ngals=err_ngals, $
   ninbin=ninbin, $
   nbins=nbins, $
   xrange=xrange
  compile_opt idl2
  debug = ajs_debug()
  IF debug GE 1 THEN message, 'Estimating number counts', /inf

  IF n_elements(bincentres) EQ 0 THEN BEGIN
      IF n_elements(nbins) EQ 0 THEN $
         nbins = 24
      IF n_elements(xrange) GT 0 THEN $
         bincentres = ajs_linspace(min(xrange), max(xrange), nbins, $
                                   /bincentres) $
      ELSE $
         bincentres = ajs_linspace(min(mag), max(mag) + 1e-6, nbins, $
                                   /bincentres)
  ENDIF
  binsize = (max(bincentres) - min(bincentres)) / (n_elements(bincentres) - 1)
  m_min = min(bincentres) - binsize / 2.

  ngals = hist1d(double(mag), min=m_min, nbins=n_elements(bincentres), $
                 binsize=binsize, obin=obin, omin=omin, omax=omax, $
                 density=ninbin) / binsize
  err_ngals = ngals / sqrt(ninbin)

  <span class="comments">;; Empty bins: NaN</span>
  empty_bins = where(ninbin EQ 0, nempty)
  IF nempty GT 0 THEN BEGIN
      ngals[empty_bins] = !values.f_nan
      err_ngals[empty_bins] = !values.f_nan
  ENDIF

  IF n_elements(area) GT 0 THEN BEGIN 
      ngals /= area
      err_ngals /= area
  ENDIF

  return, ngals
END


<span class="comments">;+</span>
<span class="comments">; Test ajs_number_counts</span>
<span class="comments">;-</span>
PRO ajs_number_counts_test
  compile_opt idl2

  mag = ajs_linspace(10, 20, 50)
  ngals = ajs_number_counts(mag, bincentres=bincentres, $
                            area=100, nbins=30, ninbin=ninbin)
  print, ngals
  print, 'These two should be the same:'
  print, total(ninbin)
  binsize = ((max(bincentres) - min(bincentres)) / 29)
  print, total(ngals) $
         * binsize $
         * 100

END
</code>
    </div>
  </body>
</html>