<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.0 on Fri Jan 16 23:50:58 2009 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ajs_cov_mat_plot.pro (Anthony Smith's IDL routines)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ajs_cov_mat_plot.pro (Anthony Smith's IDL routines)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'rst'</span>
<span class="comments">;+</span>
<span class="comments">; Plot 1- and 2-sigma contours for covariance matrix</span>
<span class="comments">;-</span>

<span class="comments">;+</span>
<span class="comments">; Plot 1- and 2-sigma contours for covariance matrix</span>
<span class="comments">; :Params:</span>
<span class="comments">;    cov_mat : in, required</span>
<span class="comments">;       [n, n] covariance matrix (symmetric)</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;    means : in, optional, default=0</span>
<span class="comments">;       [n] mean of each parameter</span>
<span class="comments">;    labels : in, optional, type=strarr</span>
<span class="comments">;       [n] label for plot axes</span>
<span class="comments">;    reverse : in, optional</span>
<span class="comments">;       [n] Reverse parameters: 1 for yes, 0 for no</span>
<span class="comments">;    true_means : in, optional</span>
<span class="comments">;       [n] "True" values to show on plots</span>
<span class="comments">;    plotfile : in, optional</span>
<span class="comments">;       See ajs_plot_start</span>
<span class="comments">;    show_plot : in, optional</span>
<span class="comments">;       See ajs_plot_start</span>
<span class="comments">; :History:</span>
<span class="comments">;    31 Mar 2008 Written, Anthony Smith</span>
<span class="comments">;</span>
<span class="comments">;    14 May 2008 Added true_means</span>
<span class="comments">;-</span>
PRO ajs_cov_mat_plot, cov_mat, means=means, labels=labels, reverse=reverse, $
                      true_means=true_means, plotfile=plotfile, $
                      show_plot=show_plot
  compile_opt idl2
  
  <span class="comments">;; Check dimensions of covariance matrix</span>
  dims_mat = size(cov_mat, /dimensions)
  IF n_elements(dims_mat) NE 2 THEN $
     message, 'Wrong number of dimensions for covariance matrix [n, n]' $
  ELSE IF dims_mat[0] NE dims_mat[1] THEN $
     message, 'Inconsistent dimensions for covariance matrix [n, n]'
  n_vars = dims_mat[0]

  <span class="comments">;; Means and labels</span>
  IF n_elements(means) GT 0 AND n_elements(means) NE n_vars THEN $
     message, 'Incorrect number of elements for means' $
  ELSE IF n_elements(means) EQ 0 THEN $
     means = intarr(n_vars)
  IF n_elements(labels) GT 0 AND n_elements(labels) NE n_vars THEN $
     message, 'Incorrect number of elements for labels' $
  ELSE IF n_elements(labels) EQ 0 THEN $
     labels = strarr(n_vars)
  IF n_elements(reverse) GT 0 AND n_elements(reverse) NE n_vars THEN $ 
     message, 'Incorrect number of elements for reverse' $
  ELSE IF n_elements(reverse) EQ 0 THEN $
     reverse = intarr(n_vars)
  IF NOT array_equal(cov_mat, transpose(cov_mat)) THEN $
     message, 'Covariance matrix not symmetrical'

  <span class="comments">;; Clear plot</span>
  IF !d.name EQ 'X' THEN $
     erase
  IF n_vars GT 3 THEN $
     csize = 0.3 $
  ELSE $
     csize = 0.5
  ygap = csize / 30.

  <span class="comments">;; Start plot</span>
  IF n_elements(plotfile) GT 0 OR keyword_set(show_plot) THEN BEGIN
      open = 1
      ajs_ellipse_plot, plotfile=plotfile, open=open
      thick = 2
  ENDIF ELSE BEGIN
     open = 0
     thick = 1
     csize = csize * 1.5
 ENDELSE

  <span class="comments">;; Disable Gaussian plots (all identical - unnecessary!)</span>
  FOR i = 1, n_vars - 1 DO BEGIN <span class="comments">; Row, counting from top</span>
      FOR j = 0, n_vars - 2 DO BEGIN <span class="comments">; Column, counting from left</span>

          IF (i GT 0 OR j LT n_vars - 1) AND (i - j LT 2) THEN BEGIN
              <span class="comments">;; Plot something (else leave blank space)</span>
              
              <span class="comments">;; Axis labels</span>
              IF i - j EQ 1 THEN BEGIN
                  xtitle = labels[j + 1]
                  ytitle = labels[i - 1]
                  doxaxis = 1
                  doyaxis = 1
              ENDIF ELSE BEGIN
                  xtitle = ''
                  ytitle = ''
                  doxaxis = 0
                  doyaxis = 0
              ENDELSE

              <span class="comments">;; Next multiplot subplot (goes left then down)</span>
              IF i EQ 1 AND j EQ 0 THEN $
                 multiplot, [n_vars - 1, n_vars - 1], doxaxis=doxaxis, $
                            doyaxis=doyaxis, ygap=ygap $
              ELSE $
                 multiplot, doxaxis=doxaxis, doyaxis=doyaxis
                 
              
              IF i EQ 0 OR j EQ n_vars - 1 THEN BEGIN
                  <span class="comments">;; Gaussian (disabled: check FOR loops)</span>
<span class="comments">;;                   IF i EQ 0 THEN BEGIN</span>
<span class="comments">;;                       ;; Upright Gaussian</span>
<span class="comments">;;                       mean = means[j + 1]</span>
<span class="comments">;;                       sigma = sqrt(cov_mat[j + 1, j + 1])</span>
<span class="comments">;;                       x = ajs_linspace(mean - 3 * sigma, mean + 3 * sigma, 101)</span>
<span class="comments">;;                       gauss = exp(- (x - mean) ^ 2 / 2 / sigma ^ 2) $</span>
<span class="comments">;;                           / sigma / sqrt(2 * !PI)</span>
<span class="comments">;;                       plot, x, gauss / max(gauss), /xstyle, /ystyle, $</span>
<span class="comments">;;                             xtitle=xtitle, ytitle=ytitle</span>
<span class="comments">;;                   ENDIF ELSE BEGIN</span>
<span class="comments">;;                       ;; Sideways Gaussian</span>
<span class="comments">;;                       mean = means[i - 1]</span>
<span class="comments">;;                       sigma = sqrt(cov_mat[i - 1, i - 1])</span>
<span class="comments">;;                       x = ajs_linspace(mean - 3 * sigma, mean + 3 * sigma, 101)</span>
<span class="comments">;;                       gauss = exp(- (x - mean) ^ 2 / 2 / sigma ^ 2) $</span>
<span class="comments">;;                           / sigma / sqrt(2 * !PI)</span>
<span class="comments">;;                       plot, gauss / max(gauss), x, /xstyle, /ystyle, $</span>
<span class="comments">;;                             xtitle=xtitle, ytitle=ytitle</span>
<span class="comments">;;                   ENDELSE</span>
              ENDIF ELSE BEGIN
                  <span class="comments">;; 1- and 2-sigma contour plot</span>
                  <span class="comments">;; Correlation</span>
                  sigma_x = sqrt(cov_mat[j + 1, j + 1])
                  sigma_y = sqrt(cov_mat[i - 1, i - 1])
                  rho = cov_mat[i - 1, j + 1] / sigma_x / sigma_y
                  xrange = [means[j + 1] - 2 * sigma_x, $
                            means[j + 1] + 2 * sigma_x]
                  yrange = [means[i - 1] - 2 * sigma_y, $
                            means[i - 1] + 2 * sigma_y]
                  IF n_elements(true_means) GT 1 THEN BEGIN
                      <span class="comments">;; Plot '+' symbol for "true" values</span>
                      xrange[0] = min([xrange[0], true_means[j + 1] $
                                       - abs(true_means[j + 1]) * 1e-6])
                      xrange[1] = max([xrange[1], true_means[j + 1] $
                                       + abs(true_means[j + 1]) * 1e-6])
                      yrange[0] = min([yrange[0], true_means[i - 1] $
                                       - abs(true_means[i - 1]) * 1e-6]) 
                      yrange[1] = max([yrange[1], true_means[i - 1] $
                                       + abs(true_means[i - 1]) * 1e-6])
                  ENDIF
                  IF reverse[j + 1] THEN $
                     xrange = reverse(xrange)
                  IF reverse[i - 1] THEN $
                     yrange = reverse(yrange)
                  ajs_ellipse_plot, sigma_x, sigma_y, $
                                    means[j + 1], means[i - 1], $
                                    rho=rho, n_sigma=[1, 2], $
                                    xrange=xrange, yrange=yrange, $
                                    <span class="comments">;;/xstyle, /ystyle, $</span>
                                    xtitle=xtitle, ytitle=ytitle, $
                                    charsize=csize, xthick=thick, $
                                    ythick=thick, charthick=thick
                  IF n_elements(true_means) GT 1 THEN $
                     <span class="comments">;; Plot '+' symbol for "true" values</span>
                     oplot, [true_means[j + 1]], [true_means[i - 1]], psym=1
              ENDELSE
          ENDIF ELSE BEGIN 
              <span class="comments">;; Next subplot (leave blank)</span>
              IF i EQ 0 AND j EQ 0 THEN $
                 multiplot, [n_vars, n_vars], gap=0 $
              ELSE $
                 multiplot
          ENDELSE
          
      ENDFOR
  ENDFOR
  
  <span class="comments">;; Close plot (if necessary)</span>
  IF open EQ 1 THEN $
     ajs_ellipse_plot, plotfile=plotfile, /close, show_plot=show_plot

  <span class="comments">;; Reset multiplot options</span>
<span class="comments">;;   IF n_vars GT 2 THEN $</span>
<span class="comments">;;      !P.charsize = charsizetemp</span>
  multiplot, /default
END


<span class="comments">;+</span>
<span class="comments">; Test ajs_cov_mat_plot</span>
<span class="comments">;-</span>
PRO ajs_cov_mat_plot_test
  means = [-23.042634, -0.38052661, 0.017801707, 17.324397, 0.58152665, 0.24535320]
  reverse = [1, 0, 0, 1, 0, 0]
  labels = ['M*', '!4a!3', '!4u!3*', '!4l!3*', '!4r!Dl!U!3', '!4b!3']
  cov_mat = [[0.00011233944, 0.00012717791, 1.5205410e-06, 2.5459600e-05, 4.4394161e-06, 5.2019502e-06], $
             [0.00012717791, 0.00020450268, 1.5074665e-06, 2.4230836e-05, 3.2560968e-07, -4.1112576e-06], $
             [1.5205410e-06, 1.5074665e-06, 3.4861713e-08, 4.4584887e-07, 6.8802010e-08, 1.0825542e-07], $
             [2.5459600e-05, 2.4230836e-05, 4.4584887e-07, 2.5795079e-05, 2.0363024e-06, 1.1370081e-05], $
             [4.4394161e-06, 3.2560968e-07, 6.8802010e-08, 2.0363024e-06, 4.6717352e-06, 1.4206954e-06], $
             [5.2019502e-06, -4.1112576e-06, 1.0825542e-07, 1.1370081e-05, 1.4206954e-06, 1.5966081e-05]]
  ajs_cov_mat_plot, cov_mat, means=means, reverse=reverse, labels=labels, $
                    /show_plot
END
</code>
    </div>
  </body>
</html>