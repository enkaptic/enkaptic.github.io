<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.0 on Tue Mar  4 15:11:24 2008 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ajs_gauss_fit.pro (Anthony Smith's IDL routines)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ajs_gauss_fit.pro (Anthony Smith's IDL routines)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">; docformat = 'idl'</span>
<span class="comments">;+</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	This function finds the best-fitting Schechter function for a</span>
<span class="comments">;	given array of absolute magnitudes, phi and phi_err</span>
<span class="comments">;-</span>

<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	ajs_schechter_fit</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	This function finds the best-fitting Schechter function for a</span>
<span class="comments">;	given array of absolute magnitudes, phi and phi_err</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;	absmag</span>
<span class="comments">;	phi</span>
<span class="comments">;	phierr</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;	params_init	Initial guess for [mstar,alpha,phistar] (or default)</span>
<span class="comments">;	txtfile		Output text file</span>
<span class="comments">;</span>
<span class="comments">; KEYWORD PARAMETERS:</span>
<span class="comments">;	loglum	Set to input log10 luminosity instead of absolute magnitudes</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;	Result	[mstar,alpha,phistar]</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUTS:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; SIDE EFFECTS:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; RESTRICTIONS:</span>
<span class="comments">;	Uses mpfit (idlutils)</span>
<span class="comments">;	ajs_schechter</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;	5 Sep 2007 Created, Anthony Smith</span>
<span class="comments">;	17 Jan 2008 Added loglum keyword and text file output, AJS</span>
<span class="comments">;-</span>
FUNCTION ajs_schechter_fit,absmag, phi, phierr, params_init, txtfile=txtfile, $
                           loglum=loglum

  IF n_elements(params_init) EQ 0 THEN $
     params_init=[median(absmag), -0.5, 0.005]

  IF NOT keyword_set(loglum) THEN $
     loglum = 0

  IF (where(phierr EQ 0))[0] NE -1 THEN $
     print, 'ajs_schechter_fit warning: ignoring bins with zero error.'
  params=mpfitfun('ajs_schechter', $
                  absmag[where(phi GT 0)], $
                  phi[where(phi GT 0)], $
                  phierr[where(phi GT 0)], $
                  params_init,/quiet, covar=covar, perror=perror, $
                  functargs=create_struct('loglum', loglum))
<span class="comments">;;   print, 'PError:', float(perror)</span>
<span class="comments">;;   print, 'Covariance:'</span>
<span class="comments">;;   print, float(covar)</span>
<span class="comments">;;   PCOR = covar * 0</span>
<span class="comments">;;   n = 3</span>
<span class="comments">;;   FOR i = 0, n-1 DO FOR j = 0, n-1 DO $</span>
<span class="comments">;;      PCOR(i,j) = covar(i,j)/sqrt(covar(i,i)*covar(j,j))</span>
<span class="comments">;;   print, 'Correlation:'</span>
<span class="comments">;;   print, float(pcor)</span>

  IF keyword_set(txtfile) THEN BEGIN
      <span class="comments">;; Text file</span>
      openw, unit, txtfile, /get_lun
      printf, unit, params
      free_lun, unit
  ENDIF

  RETURN,params

END

<span class="comments">;+</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;	Test ajs_schechter_fit</span>
<span class="comments">;-</span>
PRO ajs_schechter_fit_test

  params_true = [-25, -1.3, 0.02123]
  m = ajs_linspace(-20, -26, 51)
  print,'Starting with', params_true
  phi = ajs_schechter(m, params_true)
  phierr = phi / 10
  plot, m, phi, /ylog

  <span class="comments">;; Fit</span>
  params = ajs_schechter_fit(m, phi, phierr)
  print,'Fitted parameters:', params
  phifit = ajs_schechter(m, params)
  oplot, m, phifit, color=1, linestyle=5


END
</code>
    </div>
  </body>
</html>